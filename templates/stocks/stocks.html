{% extends 'base.html' %}

{% block title %}
Price Chart
{% endblock %}

{% block body%}

    <!-- BACKGROUND TOP-MENU -->
    <div class="background__main2">

    </div>
   <!-- ----------  -->

    <div class="container-fluid background__white position__rel m0p0 " style="height: 100vh;" >
        <div>
            <!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container">
   <div class="tradingview-widget-container__widget"></div>
   <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
   {
   "symbols": [
     {
       "proName": "FOREXCOM:SPXUSD",
       "title": "S&P 500"
     },
     {
       "proName": "FOREXCOM:NSXUSD",
       "title": "Nasdaq 100"
     },
     {
       "proName": "FX_IDC:EURUSD",
       "title": "EUR/USD"
     },
     {
       "description": "DOW Jones",
       "proName": "FOREXCOM:DJI"
     },
     {
       "description": "Tesla Inc.",
       "proName": "NASDAQ:TSLA"
     },
     {
       "description": "NIO INC",
       "proName": "NYSE:NIO"
     },
     {
       "description": "SFOR otc pink",
       "proName": "OTC:SFOR"
     },
     {
       "description": "Amazon com inc",
       "proName": "NASDAQ:AMZN"
     },
     {
       "description": "AMD inc.",
       "proName": "NASDAQ:AMD"
     },
     {
       "description": "Apple inc.",
       "proName": "NASDAQ:AAPL"
     }
   ],
   "showSymbolLogo": true,
   "colorTheme": "light",
   "isTransparent": true,
   "displayMode": "adaptive",
   "locale": "en"
 }
   </script>
 </div>
 <!-- TradingView Widget END -->
       </div>
       <div class="row m0p0">
           <div class="col-lg-12  m0p0">

               <div class="pt-2 offset-lg-1">
                   <a href="/home">home/</a>
                   <a href="#" style="color: #425800;">stocks/ pricechart </a>
               </div>

              
               
               <div class="col col-12 col-lg-6 m0p0 mx-auto">
                   
                   <div class="d-flex p-1">
                       <div>
                           <label class="tickerInput pl-1" for="ticker"> <b>Company Ticker :</b>  </label>
                       </div>
                       <div style="width: 100%;">
                           <input id="autocomplete" class="form-control input_1 shadow1" type="text" name="ticker" style="border-radius:0 0 0 0;width: 100%;border-radius: 5px;"
                           value="{{ companyTicker }}">
                       </div>
                   </div>
               </div>
           </div>
       </div>
       <div class="row d-flex justify-content-center m0p0">
        <!-- <div class="col-lg-9 d-flex justify-content-center" >
                <div class="btn-group d-flex buttons_1">
                    <a href="/stocks/pricechart" class="btn" id="table_price" role="button">PRICE CHART</a>
                    <a href="/stocks/tradingideas" class="btn" id="table_trading" role="button">TRADING IDEAS</a>
                    <a href="/stocks/news" class="btn" id="table_news" role="button">NEWS</a>
                    <a href="/stocks/dividends" class="btn" id="table_dividends" role="button">DIVIDENDS</a>
                    <a href="/stocks/majorholders" class="btn" id="table_major" role="button">MAJOR HOLDERS</a>
                    <a href="/stocks/financials" class="btn" id="table_financials" role="button">FINANCIALS</a>
                    <a href="/stocks/jyforum" class="btn" id="table_forum" role="button">J&Y FORUM</a>
                </div>

        </div>  -->
        <!--  tabs big monitors  -->

        <div class="col-lg-12 d-flex justify-content-center m0p0">
            <div class="col-lg-10 d-flex justify-content-center ">
                <div class="col-lg-12 m0p0 mt-2">
                    <div class="col-lg-12 m0p0 d-flex ">
                        <div class="col-lg-4 mr-2">
                            <h2 class="text-center">NASDAQ</h2>
                            <div class="row m0p0">
                                {% for ticker in tickers_nsdq %}
                                <div class="col-lg-4 border" style="height: 100px;">
                                    <div class="text-center">
                                        {{ ticker.ticker.symbol }}
                                    </div>

                                    <input type="hidden" value="{{ ticker.ticker.close_price }}" name="{{ ticker.ticker.symbol }}">
                                    <div class="text-center" id="{{ticker.ticker.symbol}}">
                                        
                                        <p class="{{ticker.ticker.symbol}}">
                                            {{ticker.ticker.last_price}}
                                        </p>
                                    </div>
                                </div>    
                          
    
    
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-lg-4 mr-2 ml-2">
                            <h2 class="text-center">DOW JONES</h2>
                            <div class="row m0p0">
                                {% for ticker in tickers_dj %}
                                <div class="col-lg-4 border" style="height: 100px;">
                                    <div class="text-center">
                                        {{ ticker.ticker.symbol }}
                                    </div>
                                    <input type="hidden" value="{{ ticker.ticker.close_price }}" name="{{ ticker.ticker.symbol }}">
                                    <div class="text-center" id="{{ticker.ticker.symbol}}">
                                        
                                        <p class="{{ticker.ticker.symbol}}">
                                            {{ticker.ticker.last_price}}
                                        </p>
                                    </div>
                                </div>    
                          
    
    
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="col-lg-4 ml-2">
                            <h2 class="text-center">S&P-500</h2>
                            <div class="row m0p0">
                                {% for ticker in tickers_sp %}
                                <div class="col-lg-4 border" style="height: 100px;">
                                    <div class="text-center">
                                        {{ ticker.ticker.symbol }}
                                    </div>
                                    <input type="hidden" value="{{ ticker.ticker.close_price }}" name="{{ ticker.ticker.symbol }}">
                                    <div class="text-center" id="{{ticker.ticker.symbol}}">
                                        
                                        <p class="{{ticker.ticker.symbol}}">
                                            {{ticker.ticker.last_price}}
                                        </p>
                                    </div>
                                </div>    
                          
    
    
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                 </div>
               </div>








                    <div class="container d-lg-none">
                        <div class="row ">
                        {% for ticker in tickers %}
                                       
                                        
                        
                            <div class="col-lg-4 border p-4" style="height: 100px;">
                                <div class="text-center">
                                    {{ ticker.ticker.close_price }}
                                </div>
                              
                                <div class="text-center" id="{{ticker.ticker.symbol}}">
                                    
                                    <p class="{{ticker.ticker.symbol}}">
                                        {{ticker.ticker.last_price}}
                                    </p>
                                </div>
                            </div>
                            
                      


                        {% endfor %}

                        </div>
                    </div>
                </div>
               
            </div> 


</div>

     

     



    
    
    

    <script type="text/javascript" src="{{ url_for('static', filename='js/autocomplete.js')}}"></script>
    <script src="https://cdn.socket.io/3.1.1/socket.io.min.js" integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO" crossorigin="anonymous"></script>
    <script>

    let $arr_price = $('#hot_map div[name*="price"]');
    let $arr_ticker = $('#hot_map div[name*="ticker"]');
    
    
    
        const socket = io();
        socket.on('connect', function() {
            socket.on('message', (msg) => {
                
               
                var data = JSON.parse(msg);
                if (data) {
                    var symbol = data['symbol'],
                    price = data['last_price'];
                    let close_price = $('input[name="' +symbol+ '"]').val();
                    var old_price = $('.' + symbol).html();
                    let percent = (price - close_price)/close_price*100 ;
                    let newPercent = parseFloat(percent).toFixed(3);
                    console.log(close_price)
                    $("#"+symbol).html("<p class='"+ symbol +" m0p0'>"+ price +" </p>  "+ newPercent + '%');
                    
                     if (parseFloat(old_price) > parseFloat(price)) {
                      
                         $("#"+symbol).parent().css('background', 'red')
                         
                     }else {
                        $("#"+symbol).parent().css('background', 'green')
                     }
                    }
            })
        });
    </script>
    
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/newAutocomplete.js')}}"></script> -->
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/autocomplete.js')}}"></script> -->
{% endblock %}

{% block active2%}
active
{% endblock %}